{% extends "base.html" %}

{% block title %}Proof of Humanity - Human Verification Through Trusted Relationships{% endblock %}

{% block styles %}
<link rel="stylesheet" href="{{ url_for('static', filename='css/index.css') }}?v={{ now().strftime('%Y%m%d%H%M%S') }}">
<style>
    /* Force dark mode for all sections on the landing page */
    body, 
    .main-content, 
    .hero-section, 
    .features-section, 
    .combined-features-benefits, 
    .how-it-works, 
    .network-preview-section, 
    .testimonials-section, 
    .faq-section, 
    .cta-section {
        background-color: var(--color-bg-dark) !important;
        color: var(--text-inverted) !important;
    }

    /* Ensure cards and containers use dark mode as well */
    .card, 
    .feature-card, 
    .step-card, 
    .faq-item {
        background-color: var(--color-surface-dark) !important;
        border-color: var(--color-border-dark) !important;
        color: var(--text-inverted) !important;
    }
    
    /* Fix any white text that might be on dark backgrounds */
    h1, h2, h3, h4, h5, h6, p, a, li, span:not(.text-gradient) {
        color: var(--text-inverted) !important;
    }
    
    /* Highlight text styling */
    .highlight {
        color: #43d1ff !important;
        font-weight: 600;
  }
</style>
{% endblock %}

{% block content %}
<div class="debug-box" id="debugBox" style="display: none; position: fixed; top: 20px; right: 20px; background: rgba(0,0,0,0.8); color: white; padding: 15px; border-radius: 5px; z-index: 9999; max-height: 80vh; overflow: auto; width: 400px;"></div>

<button id="debugBtn" style="position: fixed; bottom: 20px; right: 20px; background: #7a43ff; color: white; border: none; border-radius: 5px; padding: 8px 16px; z-index: 10000; cursor: pointer;">Debug</button>

<div class="hero-section">
    <div class="hero-content">
        <h1 class="hero-title">Proof of Humanity</h1>
        <p class="hero-description">
            A social identity verification system built on a web of trust network. Join our invitation-only community and become part of a revolutionary approach to human verification. <span class="highlight">Digital Identity is free forever.</span>
        </p>
        <div class="hero-cta">
            <a href="{{ url_for('register') }}" class="btn-web5">Join Now</a>
            <a href="{{ url_for('about') }}" class="btn-ghost">Learn More</a>
        </div>
    </div>
    <div class="hero-visual">
        <div class="visualization-container" style="position: relative; width: 100%; height: 100%; min-height: 400px; border-radius: 16px; overflow: hidden; background: rgba(15, 23, 42, 0.8); box-shadow: 0 4px 30px rgba(0, 0, 0, 0.1);">
            <div id="loading-indicator" style="position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); text-align: center; color: white; z-index: 1;">
                <div style="border: 3px solid rgba(122, 67, 255, 0.3); border-top: 3px solid #7a43ff; border-radius: 50%; width: 40px; height: 40px; margin: 0 auto 20px; animation: spin 2s linear infinite;"></div>
                <p>Loading network visualization...</p>
            </div>
            <div id="hero-visualization" style="width: 100%; height: 100%; min-height: 400px;"></div>
        </div>
    </div>
</div>

<section class="section quote-section">
    <div class="container">
        <blockquote class="quote-card">
            <p>The Proof of Humanity system enables a new era of human verification, where identity is validated through social connections rather than centralized authorities. This invitation-only network creates possibilities for more equitable governance, trustless interactions, and protection against identity fraud and sybil attacks.</p>
            <cite>A revolutionary approach to human verification</cite>
        </blockquote>
    </div>
</section>

<section class="section combined-features-benefits">
    <div class="container">
        <div class="section-header">
            <h2>Why Choose Proof of Humanity</h2>
            <p>Key features and benefits that make our approach unique</p>
        </div>
        <div class="features-grid">
            <div class="feature-card">
                <div class="feature-icon">
                    <i class="fas fa-network-wired"></i>
                </div>
                <h3>Web of Trust</h3>
                <p>Build connections in a decentralized trust network where verification happens through trusted human relationships. Our invitation-only network ensures quality connections and strong protection.</p>
            </div>
            <div class="feature-card">
                <div class="feature-icon">
                    <i class="fas fa-shield-alt"></i>
                </div>
                <h3>Sybil Resistance</h3>
                <p>Our multi-layered verification process makes it extremely difficult to create fake identities or impersonate others.</p>
            </div>
            <div class="feature-card">
                <div class="feature-icon">
                    <i class="fas fa-id-card-alt"></i>
                </div>
                <h3>Verification without Government ID</h3>
                <p>Prove your humanity without sharing government identification or other sensitive documents. Your Digital Identity (DID) is free forever.</p>
            </div>
            <div class="feature-card">
                <div class="feature-icon">
                    <i class="fas fa-bolt"></i>
                </div>
                <h3>One-Time Process</h3>
                <p>Verify once and use your digital identity across multiple platforms without repeated verifications.</p>
            </div>
            <div class="feature-card">
                <div class="feature-icon">
                    <i class="fas fa-lock"></i>
                </div>
                <h3>Privacy Focused</h3>
                <p>Maintain control over your personal information while still participating in a verified community.</p>
            </div>
            <div class="feature-card">
                <div class="feature-icon">
                    <i class="fas fa-users"></i>
                </div>
                <h3>Community Governance</h3>
                <p>Verified users participate in the governance of the system, ensuring fair and transparent decision-making.</p>
            </div>
        </div>
    </div>
</section>

<section class="section stats-section">
    <div class="container">
        <div class="stats-grid grid-cols-3">
            <div class="stat-card">
                <div class="stat-number" data-count="10000">0</div>
                <div class="stat-label">Verified Humans</div>
            </div>
            
            <div class="stat-card">
                <div class="stat-number" data-count="3500">0</div>
                <div class="stat-label">Trust Groups</div>
            </div>
            
            <div class="stat-card">
                <div class="stat-number" data-count="25000">0</div>
                <div class="stat-label">Connections</div>
            </div>
        </div>
    </div>
</section>

<section id="how-it-works" class="section how-it-works">
    <div class="container">
        <div class="section-header-web5">
            <h2 class="section-title-web5">How It Works</h2>
            <p class="section-subtitle-web5">Our human verification system leverages the most reliable network: trusted human connections</p>
        </div>
        
        <div class="steps-container grid-cols-3">
            <div class="card-web5 step-card">
                <div class="step-icon">
                    <i class="fas fa-user-plus"></i>
                </div>
                <h3>1. Join the Network</h3>
                <p>Receive an invite link from someone who trusts you, create your account, and join the trusted verification network.</p>
            </div>
            
            <div class="card-web5 step-card">
                <div class="step-icon">
                    <i class="fas fa-video"></i>
                </div>
                <h3>2. Verify Each Other</h3>
                <p>Schedule and complete a video verification call with a group of 5 humans, guided by our AI assistant.</p>
            </div>
            
            <div class="card-web5 step-card">
                <div class="step-icon">
                    <i class="fas fa-fingerprint"></i>
                </div>
                <h3>3. Get Your Digital ID</h3>
                <p>Once verified by the group, receive your decentralized identifiers (DIDs) that prove your humanity.</p>
            </div>
        </div>
    </div>
</section>

<section class="section faq-section">
    <div class="container">
        <div class="section-header">
            <h2 class="section-title">Frequently Asked Questions</h2>
            <p class="section-subtitle">Get answers to common questions about Proof of Humanity</p>
        </div>
        
        <div class="faq-container">
            <div class="faq-item">
                <div class="faq-question">
                    <h3>What is Proof of Humanity?</h3>
                    <span class="faq-toggle"><i class="fas fa-plus"></i></span>
                </div>
                <div class="faq-answer">
                    <p>Proof of Humanity is a novel approach to verifying human identities in digital spaces. Unlike traditional methods that rely on personal documentation or centralized authorities, we leverage trusted family relationships to create a robust and privacy-preserving verification system.</p>
                </div>
            </div>
            
            <div class="faq-item">
                <div class="faq-question">
                    <h3>How does family verification work?</h3>
                    <span class="faq-toggle"><i class="fas fa-plus"></i></span>
                </div>
                <div class="faq-answer">
                    <p>Users are invited to the network by people who already know and trust them. Together with an AI facilitator, a group of 5 humans are prompted to verify each other's humanity during a live video call. After enough verifications, you receive your DID (decentralized identity) that can be used to validate yourself on any platform that accepts our protocol.</p>
                </div>
            </div>
            
            <div class="faq-item">
                <div class="faq-question">
                    <h3>Is my personal information safe?</h3>
                    <span class="faq-toggle"><i class="fas fa-plus"></i></span>
                </div>
                <div class="faq-answer">
                    <p>Yes. Proof of Humanity is designed with privacy as a core principle. We collect minimal personal information, and the verification process happens between you and trusted individuals, not through a centralized authority. Your data is encrypted and you control who has access to your verification status.</p>
                </div>
            </div>
            
            <div class="faq-item">
                <div class="faq-question">
                    <h3>What if I don't have family members to verify me?</h3>
                    <span class="faq-toggle"><i class="fas fa-plus"></i></span>
                </div>
                <div class="faq-answer">
                    <p>Our system works by creating an unbroken chain of trust. You are invited into a family unit by someone who already knows and trusts you. This creates connections across the entire network where trust is maintained through direct personal relationships. You don't need an "outside family" - the system is designed to build trust through existing connections.</p>
                </div>
            </div>
            
            <div class="faq-item">
                <div class="faq-question">
                    <h3>Where can I use my Proof of Humanity verification?</h3>
                    <span class="faq-toggle"><i class="fas fa-plus"></i></span>
                </div>
                <div class="faq-answer">
                    <p>Your Proof of Humanity verification can be used across any web3 application or service that integrates with our protocol. We're actively partnering with platforms across DeFi, NFT marketplaces, voting systems, and other web3 services to expand the utility of your verification.</p>
                </div>
            </div>
        </div>
    </div>
</section>

<section class="section cta-section">
    <div class="container">
        <div class="cta-card">
            <h2>Ready to Join Our Community?</h2>
            <p>Start your verification journey today and become part of our growing network of verified humans.</p>
            <div class="cta-buttons">
                <a href="{{ url_for('register') }}" class="btn-web5">Sign Up Now</a>
                <a href="{{ url_for('verification_manage') }}" class="btn-ghost">Learn About Verification</a>
            </div>
        </div>
    </div>
</section>

<script>
  // Enhanced debug system
  document.addEventListener('DOMContentLoaded', function() {
    console.log("Debug system initializing");
    
    const debugBtn = document.getElementById('debugBtn');
    const debugBox = document.getElementById('debugBox');
    
    if (debugBtn && debugBox) {
      // Pre-populate debug box with a test message
      debugBox.innerHTML = '<div style="color: #00ff66;">[INFO] Debug system ready</div>';
      
      // Listen for visualization debug messages
      window.addEventListener('message', function(event) {
        if (event.data && (event.data.type === 'viz-debug' || event.data.type === 'network-viz-debug')) {
          const level = event.data.level || 'info';
          const message = event.data.message || 'No message';
          addDebugInfo(`[VIZ] ${message}`, level);
        }
      });

      debugBtn.addEventListener('click', function() {
        console.log("Debug button clicked");
        const isVisible = debugBox.style.display !== 'none';
        
        if (isVisible) {
          debugBox.style.display = 'none';
          document.body.classList.remove('debug-mode');
        } else {
          debugBox.style.display = 'block';
          document.body.classList.add('debug-mode');
          
          // Add debug information
          addDebugInfo("Window dimensions: " + window.innerWidth + "x" + window.innerHeight);
          addDebugInfo("User agent: " + navigator.userAgent);
          
          // Check visualization iframe
          const iframe = document.getElementById('visualization-iframe');
          if (iframe) {
            addDebugInfo("Iframe found: " + iframe.src);
            
            try {
              // Check iframe content
              const iframeLoaded = iframe.contentWindow && iframe.contentDocument;
              addDebugInfo("Iframe access: " + (iframeLoaded ? "Yes" : "No"));
            } catch (e) {
              addDebugInfo("Cannot access iframe content due to security restrictions", "warning");
            }
          } else {
            addDebugInfo("Iframe not found", "error");
          }
          
          // Check for D3.js
          if (window.d3) {
            addDebugInfo("D3.js in parent window: version " + window.d3.version);
          } else {
            addDebugInfo("D3.js not found in parent window", "info");
          }
        }
      });
    }
  });
  
  // Add debug information to debug box
  function addDebugInfo(message, type = "info") {
    const debugBox = document.getElementById('debugBox');
    if (!debugBox) return;
    
    const color = type === "error" ? "#ff5757" : 
                  type === "warning" ? "#ffbb00" : "#ffffff";
    
    const entry = document.createElement('div');
    entry.style.color = color;
    entry.style.margin = "5px 0";
    entry.style.fontFamily = "monospace";
    entry.textContent = '[' + type.toUpperCase() + '] ' + message;
    
    debugBox.appendChild(entry);
    debugBox.scrollTop = debugBox.scrollHeight;
    console.log(type.toUpperCase() + ": " + message);
  }

  // Enhanced iframe handlers
  function handleIframeLoad(event) {
    console.log("Iframe loaded successfully");
    document.getElementById('loading-indicator').style.display = 'none';
    
    // Try to communicate with the iframe
    try {
      const iframe = document.getElementById('visualization-iframe');
      if (iframe && iframe.contentWindow) {
        iframe.contentWindow.postMessage({
          type: 'viz-parent-ready'
        }, '*');
      }
    } catch (e) {
      console.error("Error communicating with iframe:", e);
    }
  }

  function handleIframeError(event) {
    console.error("Iframe failed to load:", event);
    document.getElementById('loading-indicator').innerHTML = `
      <div style="color: #ff5757;">
        <p>Visualization load error</p>
        <button onclick="reloadVisualization()" style="background: #7a43ff; color: white; border: none; border-radius: 4px; padding: 5px 10px; margin-top: 10px; cursor: pointer;">
          Retry
        </button>
        <button onclick="showFallbackVisualization()" style="background: rgba(255,255,255,0.2); color: white; border: none; border-radius: 4px; padding: 5px 10px; margin-top: 10px; margin-left: 10px; cursor: pointer;">
          Show Fallback
        </button>
      </div>
    `;
  }

  function reloadVisualization() {
    const iframe = document.getElementById('visualization-iframe');
    if (iframe) {
      // Reset loading indicator
      document.getElementById('loading-indicator').innerHTML = `
        <div style="border: 3px solid rgba(122, 67, 255, 0.3); border-top: 3px solid #7a43ff; border-radius: 50%; width: 40px; height: 40px; margin: 0 auto 20px; animation: spin 2s linear infinite;"></div>
        <p>Reloading visualization...</p>
      `;
      document.getElementById('loading-indicator').style.display = 'block';
      
      // Reload iframe with timestamp to prevent caching
      iframe.src = "{{ url_for('network.viz') }}?t=" + new Date().getTime();
    }
  }
</script>

<script>
// Iframe error handler
function handleIframeError(event) {
    console.error("Iframe failed to load:", event);
    document.getElementById('loading-indicator').innerHTML = `
        <div style="color: #ff5757;">
            <p>Using fallback visualization</p>
        </div>
    `;
    
    // Show fallback visualization immediately
    showFallbackVisualization();
}

// Show fallback visualization
function showFallbackVisualization() {
    // Hide the iframe
    const iframe = document.getElementById('visualization-iframe');
    if (iframe) iframe.style.display = 'none';
    
    // Create fallback SVG
    const container = document.querySelector('.iframe-container');
    const fallbackViz = document.createElement('div');
    fallbackViz.className = 'fallback-visualization';
    fallbackViz.style.width = '100%';
    fallbackViz.style.height = '100%';
    fallbackViz.style.minHeight = '400px';
    fallbackViz.style.position = 'relative';
    fallbackViz.style.zIndex = '5';
    
    fallbackViz.innerHTML = `
            <svg width="100%" height="100%" viewBox="0 0 800 600" xmlns="http://www.w3.org/2000/svg">
              <defs>
                <linearGradient id="grad1" x1="0%" y1="0%" x2="100%" y2="100%">
                  <stop offset="0%" stop-color="#7a43ff" stop-opacity="0.7" />
                  <stop offset="100%" stop-color="#43d1ff" stop-opacity="0.7" />
                </linearGradient>
              </defs>
              <g class="links" stroke-width="1" stroke-opacity="0.6">
                <line x1="400" y1="300" x2="250" y2="200" stroke="#7a43ff" />
                <line x1="400" y1="300" x2="550" y2="200" stroke="#7a43ff" />
                <line x1="400" y1="300" x2="250" y2="400" stroke="#7a43ff" />
                <line x1="400" y1="300" x2="550" y2="400" stroke="#7a43ff" />
                <line x1="250" y1="200" x2="150" y2="300" stroke="#43d1ff" />
                <line x1="550" y1="200" x2="650" y2="300" stroke="#43d1ff" />
                <line x1="250" y1="200" x2="350" y2="120" stroke="#43d1ff" />
                <line x1="550" y1="200" x2="450" y2="120" stroke="#43d1ff" />
                <line x1="250" y1="400" x2="350" y2="480" stroke="#43d1ff" />
                <line x1="550" y1="400" x2="450" y2="480" stroke="#43d1ff" />
              </g>
            <g class="nodes">
                <circle cx="400" cy="300" r="40" fill="url(#grad1)" class="pulse-circle" />
                <circle cx="250" cy="200" r="20" fill="#7a43ff" opacity="0.7" class="pulse-circle" />
                <circle cx="550" cy="200" r="20" fill="#7a43ff" opacity="0.7" class="pulse-circle" />
                <circle cx="250" cy="400" r="20" fill="#7a43ff" opacity="0.7" class="pulse-circle" />
                <circle cx="550" cy="400" r="20" fill="#7a43ff" opacity="0.7" class="pulse-circle" />
                <circle cx="150" cy="300" r="15" fill="#43d1ff" opacity="0.7" class="pulse-circle" />
                <circle cx="650" cy="300" r="15" fill="#43d1ff" opacity="0.7" class="pulse-circle" />
                <circle cx="350" cy="120" r="15" fill="#43d1ff" opacity="0.7" class="pulse-circle" />
                <circle cx="450" cy="120" r="15" fill="#43d1ff" opacity="0.7" class="pulse-circle" />
                <circle cx="350" cy="480" r="15" fill="#43d1ff" opacity="0.7" class="pulse-circle" />
                <circle cx="450" cy="480" r="15" fill="#43d1ff" opacity="0.7" class="pulse-circle" />
            </g>
            </svg>
    `;
    
    container.appendChild(fallbackViz);
    
    // Add subtle animation
    const style = document.createElement('style');
    style.textContent = `
        @keyframes pulse {
            0% { r: attr(r); }
            50% { r: calc(attr(r) * 1.1); }
            100% { r: attr(r); }
        }
        .pulse-circle {
            animation: pulse 4s infinite;
            transform-origin: center;
            transform-box: fill-box;
        }
    `;
    document.head.appendChild(style);
    
    // Make circles pulsate independently
    const circles = fallbackViz.querySelectorAll('circle');
    circles.forEach((circle, index) => {
        const originalR = parseFloat(circle.getAttribute('r'));
        
        setInterval(() => {
            // Create a slightly different animation speed for each circle
            const factor = 1 + 0.1 * Math.sin((Date.now() / 1000) + (index * 0.5));
            circle.setAttribute('r', originalR * factor);
        }, 50);
    });
    
    console.log("Fallback visualization added");
}

// Add a timeout to check if iframe loaded and fall back if it didn't
        setTimeout(() => {
    const iframe = document.getElementById('visualization-iframe');
    // If loading indicator is still visible after 5 seconds, show fallback
    if (document.getElementById('loading-indicator').style.display !== 'none') {
        console.log("Iframe load timeout - showing fallback");
        showFallbackVisualization();
    }
}, 5000);
</script>

<style>
@keyframes spin {
    0% { transform: rotate(0deg); }
    100% { transform: rotate(360deg); }
}

/* Add hover glow effect to feature and benefit cards */
.feature-card, .benefit-card, .step-card {
    transition: all 0.3s ease;
    position: relative;
}

.feature-card:hover, .benefit-card:hover, .step-card:hover {
    transform: translateY(-5px);
    box-shadow: 0 10px 30px rgba(122, 67, 255, 0.3) !important;
}

.feature-card::after, .benefit-card::after, .step-card::after {
    content: '';
    position: absolute;
    top: -3px;
    left: -3px;
    right: -3px;
    bottom: -3px;
    background: linear-gradient(45deg, #7a43ff, #43d1ff, #7a43ff);
    border-radius: 18px;
    z-index: -1;
    opacity: 0;
    transition: opacity 0.3s ease;
}

.feature-card:hover::after, .benefit-card:hover::after, .step-card:hover::after {
    opacity: 0.7;
    animation: glowAnimation 2s infinite;
}

@keyframes glowAnimation {
    0% { opacity: 0.3; }
    50% { opacity: 0.7; }
    100% { opacity: 0.3; }
}

/* Add hover effects to How It Works cards */
.how-it-works-card {
    transition: all 0.3s ease;
    position: relative;
    box-shadow: 0 8px 20px rgba(0, 0, 0, 0.1);
}

.how-it-works-card:hover {
    transform: translateY(-5px);
    box-shadow: 0 12px 30px rgba(122, 67, 255, 0.3) !important;
}

.how-it-works-card::after {
    content: '';
    position: absolute;
    top: -3px;
    left: -3px;
    right: -3px;
    bottom: -3px;
    background: linear-gradient(45deg, #7a43ff, #43d1ff, #7a43ff);
    border-radius: 18px;
    z-index: -1;
    opacity: 0;
    transition: opacity 0.3s ease;
}

.how-it-works-card:hover::after {
    opacity: 0.7;
    animation: glowAnimation 2s infinite;
}

/* Mobile optimization styles */
@media (max-width: 768px) {
    .hero-section {
        flex-direction: column;
        padding: 2rem 1rem;
    }
    
    .hero-content {
        margin-right: 0;
        margin-bottom: 2rem;
        text-align: center;
    }
    
    .hero-visual {
        width: 100%;
        max-width: 100%;
    }
    
    .hero-title {
        font-size: 2.25rem;
    }
    
    .hero-description {
        font-size: 1rem;
    }
    
    .hero-cta {
        justify-content: center;
    }
    
    .iframe-container {
        min-height: 300px !important;
    }
    
    #visualization-iframe {
        min-height: 300px !important;
    }
    
    .features-grid, 
    .steps-container {
        grid-template-columns: 1fr !important;
        gap: 1.5rem;
    }
    
    .stats-grid {
        grid-template-columns: 1fr !important;
    }
    
    .feature-card, 
    .benefit-card, 
    .step-card {
        padding: 1.5rem;
    }
    
    .section-title-web5 {
        font-size: 2rem;
    }
    
    .section-subtitle-web5 {
        font-size: 1rem;
    }
    
    .debugBtn {
        bottom: 10px;
        right: 10px;
        font-size: 12px;
        padding: 6px 12px;
    }
}
</style>

<script>
// Diagnostic tool for network visualization
console.log("[DIAG] Page load started at: " + new Date().toISOString());
window.vizDiagnostics = {
    events: [],
    log: function(message, type = 'info') {
        const timestamp = new Date().toISOString();
        console.log(`[DIAG][${type.toUpperCase()}] ${message}`);
        this.events.push({
            timestamp: timestamp,
            type: type,
            message: message
        });
        
        // Try to update DOM log if it exists
        try {
            const diagLog = document.getElementById('viz-diagnostics');
            if (diagLog) {
                const entry = document.createElement('div');
                entry.innerHTML = `<span style="color:${type === 'error' ? 'red' : type === 'warning' ? 'orange' : 'green'}">[${type.toUpperCase()}]</span> ${message}`;
                diagLog.appendChild(entry);
            }
        } catch (e) {
            console.error("Error updating DOM log:", e);
        }
    },
    checkResources: function() {
        // Check if D3.js is loaded
        if (typeof d3 === 'undefined') {
            this.log('D3.js is NOT loaded', 'error');
        } else {
            this.log('D3.js is loaded, version: ' + d3.version, 'success');
        }
        
        // Check for network_viz.js script
        const scripts = Array.from(document.scripts);
        const networkVizScript = scripts.find(s => s.src && s.src.includes('network_viz.js'));
        if (networkVizScript) {
            this.log('network_viz.js script found: ' + networkVizScript.src, 'success');
        } else {
            this.log('network_viz.js script NOT found in document', 'error');
        }
        
        // Check iframe
        const iframe = document.getElementById('visualization-iframe');
        if (iframe) {
            this.log('Visualization iframe found, src: ' + iframe.src, 'info');
            // Check if iframe is visible
            const style = window.getComputedStyle(iframe);
            this.log('Iframe display: ' + style.display + ', visibility: ' + style.visibility, 
                    style.display === 'none' || style.visibility === 'hidden' ? 'warning' : 'info');
        } else {
            this.log('Visualization iframe NOT found', 'error');
        }
        
        // Check container
        const container = document.querySelector('.iframe-container');
        if (container) {
            this.log('Container found, dimensions: ' + container.offsetWidth + 'x' + container.offsetHeight, 'info');
            } else {
            this.log('Container NOT found', 'error');
        }
    }
};

// Attach listeners to key events
document.addEventListener('DOMContentLoaded', function() {
    window.vizDiagnostics.log('DOMContentLoaded event fired');
    // Wait a bit to let other scripts initialize
    setTimeout(function() {
        window.vizDiagnostics.checkResources();
    }, 500);
});

window.addEventListener('load', function() {
    window.vizDiagnostics.log('Window load event fired');
    // Check again after everything has loaded
    setTimeout(function() {
        window.vizDiagnostics.checkResources();
        
        // Add diagnostics UI
        const diagContainer = document.createElement('div');
        diagContainer.id = 'viz-diagnostics-container';
        diagContainer.style.cssText = 'position: fixed; bottom: 10px; right: 10px; z-index: 9999; background: rgba(0,0,0,0.8); color: white; padding: 10px; border-radius: 5px; max-height: 300px; overflow: auto; width: 400px; font-family: monospace; font-size: 12px; display: none;';
        
        const diagTitle = document.createElement('div');
        diagTitle.textContent = 'Visualization Diagnostics';
        diagTitle.style.cssText = 'font-weight: bold; margin-bottom: 5px; border-bottom: 1px solid #333; padding-bottom: 5px;';
        
        const diagLog = document.createElement('div');
        diagLog.id = 'viz-diagnostics';
        diagLog.style.cssText = 'max-height: 250px; overflow: auto;';
        
        diagContainer.appendChild(diagTitle);
        diagContainer.appendChild(diagLog);
        document.body.appendChild(diagContainer);
        
        // Add diagnostic toggle button
        const diagButton = document.createElement('button');
        diagButton.textContent = 'Viz Diagnostics';
        diagButton.style.cssText = 'position: fixed; bottom: 80px; right: 10px; z-index: 9999; background: #7a43ff; color: white; border: none; border-radius: 5px; padding: 5px 10px; cursor: pointer;';
        diagButton.addEventListener('click', function() {
            const container = document.getElementById('viz-diagnostics-container');
            container.style.display = container.style.display === 'none' ? 'block' : 'none';
        });
        document.body.appendChild(diagButton);
        
        // Populate log with existing events
        const diagLogElement = document.getElementById('viz-diagnostics');
        window.vizDiagnostics.events.forEach(event => {
            const entry = document.createElement('div');
            entry.innerHTML = `<span style="color:${event.type === 'error' ? 'red' : event.type === 'warning' ? 'orange' : 'green'}">[${event.type.toUpperCase()}]</span> ${event.message}`;
            diagLogElement.appendChild(entry);
        });
    }, 1000);
});

// Error monitoring
window.addEventListener('error', function(e) {
    window.vizDiagnostics.log('JavaScript error: ' + e.message + ' in ' + (e.filename || 'unknown') + ':' + (e.lineno || '?'), 'error');
  });
</script>

{% endblock %}

{% block scripts %}
{{ super() }}
<script src="{{ url_for('static', filename='js/network-visualization.js') }}"></script>
<script src="https://d3js.org/d3.v7.min.js"></script>
<script src="{{ url_for('static', filename='js/circular_family_tree.js') }}"></script>
<script>
    // Init FAQ accordions
    document.addEventListener('DOMContentLoaded', function() {
        const faqItems = document.querySelectorAll('.faq-item');
        
        faqItems.forEach(item => {
            const question = item.querySelector('.faq-question');
            const toggle = item.querySelector('.faq-toggle');
            
            if (question) {
                question.addEventListener('click', function() {
                    // Toggle active class
                    item.classList.toggle('active');
                    
                    // Change the icon
                    if (toggle) {
                        const icon = toggle.querySelector('i');
                        if (icon) {
                            icon.classList.toggle('fa-plus');
                            icon.classList.toggle('fa-minus');
                        }
                    }
                });
            }
        });
    });

    document.addEventListener('DOMContentLoaded', function() {
        // Hide loading indicator after D3 is ready
        const loadingIndicator = document.getElementById('loading-indicator');
        const visualizationContainer = document.getElementById('hero-visualization');
        
        console.log('[LANDING] DOM content loaded, preparing to initialize visualization');
        console.log('[LANDING] Loading indicator exists:', !!loadingIndicator);
        console.log('[LANDING] Visualization container exists:', !!visualizationContainer);
        
        if (loadingIndicator && visualizationContainer) {
            // Add diagnostic information
            console.log('[LANDING] Container dimensions:', {
                offsetWidth: visualizationContainer.offsetWidth,
                offsetHeight: visualizationContainer.offsetHeight,
                clientWidth: visualizationContainer.clientWidth,
                clientHeight: visualizationContainer.clientHeight
            });
            
            console.log('[LANDING] Container styles:', window.getComputedStyle(visualizationContainer));
            
            // Check if D3 is loaded
            console.log('[LANDING] D3 version loaded:', typeof d3 !== 'undefined' ? d3.version : 'Not loaded');
            
            // Add a small delay to ensure DOM is fully rendered
            setTimeout(() => {
                try {
                    console.log('[LANDING] Attempting to initialize visualization after delay');
                    // Initialize visualization
                    const circularTree = new CircularFamilyTree({
                        containerId: 'hero-visualization',
                        title: 'Proof of Humanity Network'
                    });
                    
                    // Hide loading indicator once visualization is ready
                    if (loadingIndicator) {
                        loadingIndicator.style.display = 'none';
                    }
                    
                    console.log('[LANDING] Visualization initialized successfully');
                } catch (error) {
                    console.error('[LANDING] Error initializing visualization:', error);
                    
                    // Provide a more detailed error message
                    if (loadingIndicator) {
                        loadingIndicator.innerHTML = `
                            <div style="text-align: center; color: white;">
                                <i class="fas fa-exclamation-triangle" style="font-size: 2rem; color: #ff5757; margin-bottom: 1rem;"></i>
                                <p>Error loading visualization: ${error.message}</p>
                                <p style="margin-top: 0.5rem; font-size: 0.9rem; opacity: 0.7;">
                                    Try refreshing the page or check browser console for details.
                                </p>
                                <button class="btn-web5" style="margin-top: 1rem;" onclick="location.reload()">Retry</button>
                            </div>
                        `;
                    }
                    
                    // Add fallback visualization as a static image or simple SVG
                    visualizationContainer.innerHTML += `
                        <div style="position: absolute; top: 0; left: 0; width: 100%; height: 100%; display: flex; align-items: center; justify-content: center;">
                            <svg width="300" height="300" viewBox="0 0 300 300">
                                <circle cx="150" cy="150" r="50" fill="#7a43ff" opacity="0.7" />
                                <circle cx="150" cy="80" r="30" fill="#43d1ff" opacity="0.7" />
                                <circle cx="90" cy="180" r="30" fill="#43d1ff" opacity="0.7" />
                                <circle cx="210" cy="180" r="30" fill="#43d1ff" opacity="0.7" />
                                <line x1="150" y1="150" x2="150" y2="80" stroke="#ffffff" stroke-width="2" opacity="0.5" />
                                <line x1="150" y1="150" x2="90" y2="180" stroke="#ffffff" stroke-width="2" opacity="0.5" />
                                <line x1="150" y1="150" x2="210" y2="180" stroke="#ffffff" stroke-width="2" opacity="0.5" />
                                <text x="150" y="155" text-anchor="middle" fill="white" font-size="12">You</text>
                                <text x="150" y="75" text-anchor="middle" fill="white" font-size="10">Parent</text>
                                <text x="90" y="185" text-anchor="middle" fill="white" font-size="10">Friend 1</text>
                                <text x="210" y="185" text-anchor="middle" fill="white" font-size="10">Friend 2</text>
                            </svg>
                        </div>
                    `;
                }
            }, 500); // 500ms delay
        } else {
            console.error('[LANDING] Required elements not found:', {
                loadingIndicator: !!loadingIndicator,
                visualizationContainer: !!visualizationContainer
            });
        }
    });
</script>
{% endblock %} 