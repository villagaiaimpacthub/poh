{% extends 'base.html' %}

{% block title %}Family Tree | Proof of Humanity{% endblock %}

{% block styles %}
<link rel="stylesheet" href="{{ url_for('static', filename='css/family-tree.css') }}">
<style>
    .network-container {
        max-width: 1200px;
        margin: 0 auto;
        padding: 1rem;
    }
    
    .visualization-container {
        background-color: rgba(30, 30, 40, 0.7);
        border-radius: 16px;
        box-shadow: 0 8px 30px rgba(0, 0, 0, 0.2);
        margin-bottom: 2rem;
        position: relative;
        overflow: hidden;
        min-height: 600px;
        border: 1px solid rgba(122, 67, 255, 0.3);
    }
    
    .visualization-header {
        padding: 1.5rem;
        border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        display: flex;
        justify-content: space-between;
        align-items: center;
    }
    
    .visualization-title {
        font-size: 1.5rem;
        font-weight: 600;
        color: white;
        margin: 0;
    }
    
    .controls-container {
        position: absolute;
        top: 1rem;
        right: 1rem;
        z-index: 10;
        display: flex;
        gap: 0.5rem;
    }
    
    .control-btn {
        padding: 0.5rem 1rem;
        border-radius: 8px;
        background: rgba(122, 67, 255, 0.2);
        border: 1px solid rgba(122, 67, 255, 0.3);
        color: white;
        font-weight: 500;
        display: flex;
        align-items: center;
        justify-content: center;
        cursor: pointer;
        transition: all 0.3s ease;
    }
    
    .control-btn:hover {
        background: rgba(122, 67, 255, 0.4);
        transform: translateY(-2px);
    }
    
    .control-btn i {
        margin-right: 0.5rem;
    }
    
    .legend-container {
        background-color: rgba(15, 15, 35, 0.8);
        border-radius: 12px;
        padding: 1rem;
        position: absolute;
        bottom: 1rem;
        left: 1rem;
        font-size: 0.9rem;
        z-index: 10;
        box-shadow: 0 4px 20px rgba(0, 0, 0, 0.2);
        border: 1px solid rgba(122, 67, 255, 0.3);
        color: white;
    }
    
    .legend-item {
        display: flex;
        align-items: center;
        margin-bottom: 0.75rem;
    }
    
    .legend-color {
        width: 16px;
        height: 16px;
        border-radius: 50%;
        margin-right: 0.75rem;
    }
    
    /* Pulse animation for nodes in the network */
    @keyframes pulse {
        0% { r: attr(r); }
        50% { r: calc(attr(r) * 1.1); }
        100% { r: attr(r); }
    }
    
    .pulse-circle {
        animation: pulse 4s infinite ease-in-out;
        transform-origin: center;
        transform-box: fill-box;
    }
    
    /* Static visualization styles */
    .static-visualization {
        width: 100%;
        height: 100%;
        min-height: 600px;
        display: flex;
        align-items: center;
        justify-content: center;
    }
</style>
{% endblock %}

{% block content %}
<section class="page-header">
    <div class="container">
        <div class="row">
            <div class="col-lg-8 mx-auto text-center">
                <h1>Family Tree</h1>
                <p class="lead mb-0">Explore your connections in the Proof of Humanity trust network</p>
        </div>
        </div>
    </div>
</section>
    
<section class="network-container">
    <div class="visualization-container">
        <div class="visualization-header">
            <h2 class="visualization-title">Your Trust Network</h2>
            <div>
                <button class="control-btn zoom-in">
                    <i class="fas fa-search-plus"></i> Zoom In
                </button>
                <button class="control-btn zoom-out">
                    <i class="fas fa-search-minus"></i> Zoom Out
                </button>
                <button class="control-btn reset">
                    <i class="fas fa-sync"></i> Reset
                </button>
            </div>
        </div>
        
        <!-- Direct SVG Visualization instead of iframe -->
        <div class="static-visualization" id="network-viz">
            <svg width="100%" height="100%" viewBox="0 0 1000 800" xmlns="http://www.w3.org/2000/svg">
                <defs>
                    <linearGradient id="founder-gradient" x1="0%" y1="0%" x2="100%" y2="100%">
                        <stop offset="0%" stop-color="#ff7a43" stop-opacity="0.9" />
                        <stop offset="100%" stop-color="#ffcb43" stop-opacity="0.9" />
                    </linearGradient>
                    <linearGradient id="grandparent-gradient" x1="0%" y1="0%" x2="100%" y2="100%">
                        <stop offset="0%" stop-color="#7a43ff" stop-opacity="0.9" />
                        <stop offset="100%" stop-color="#9b43ff" stop-opacity="0.9" />
                    </linearGradient>
                    <linearGradient id="parent-gradient" x1="0%" y1="0%" x2="100%" y2="100%">
                        <stop offset="0%" stop-color="#7a43ff" stop-opacity="0.7" />
                        <stop offset="100%" stop-color="#43a1ff" stop-opacity="0.7" />
                    </linearGradient>
                    <linearGradient id="child-gradient" x1="0%" y1="0%" x2="100%" y2="100%">
                        <stop offset="0%" stop-color="#43d1ff" stop-opacity="0.7" />
                        <stop offset="100%" stop-color="#43ffd1" stop-opacity="0.7" />
                    </linearGradient>
                </defs>
                
                <!-- Links between nodes -->
                <g class="links" stroke-width="2" stroke-opacity="0.6">
                    <!-- Founder to Grandparents -->
                    <line x1="500" y1="200" x2="300" y2="300" stroke="#7a43ff" />
                    <line x1="500" y1="200" x2="700" y2="300" stroke="#7a43ff" />
                    
                    <!-- Grandparents to Parents -->
                    <line x1="300" y1="300" x2="200" y2="400" stroke="#43a1ff" />
                    <line x1="300" y1="300" x2="350" y2="400" stroke="#43a1ff" />
                    <line x1="700" y1="300" x2="650" y2="400" stroke="#43a1ff" />
                    <line x1="700" y1="300" x2="800" y2="400" stroke="#43a1ff" />
                    
                    <!-- Parents to Children -->
                    <line x1="200" y1="400" x2="150" y2="500" stroke="#43d1ff" />
                    <line x1="200" y1="400" x2="250" y2="500" stroke="#43d1ff" />
                    <line x1="350" y1="400" x2="300" y2="500" stroke="#43d1ff" />
                    <line x1="350" y1="400" x2="400" y2="500" stroke="#43d1ff" />
                    <line x1="650" y1="400" x2="600" y2="500" stroke="#43d1ff" />
                    <line x1="650" y1="400" x2="700" y2="500" stroke="#43d1ff" />
                    <line x1="800" y1="400" x2="750" y2="500" stroke="#43d1ff" />
                    <line x1="800" y1="400" x2="850" y2="500" stroke="#43d1ff" />
                    
                    <!-- Additional connections -->
                    <line x1="500" y1="200" x2="500" y2="400" stroke="#7a43ff" stroke-dasharray="5,5" />
                    <line x1="500" y1="400" x2="450" y2="500" stroke="#43d1ff" />
                    <line x1="500" y1="400" x2="550" y2="500" stroke="#43d1ff" />
                </g>
                
                <!-- Nodes for different levels in the tree -->
                <g class="nodes">
                    <!-- Founder (You) -->
                    <circle cx="500" cy="200" r="40" fill="url(#founder-gradient)" class="pulse-circle" data-level="founder" />
                    <text x="500" y="205" text-anchor="middle" fill="white" font-size="14" font-weight="bold">You</text>
                    
                    <!-- Grandparents -->
                    <circle cx="300" cy="300" r="30" fill="url(#grandparent-gradient)" class="pulse-circle" data-level="grandparent" />
                    <circle cx="700" cy="300" r="30" fill="url(#grandparent-gradient)" class="pulse-circle" data-level="grandparent" />
                    
                    <!-- Parents -->
                    <circle cx="200" cy="400" r="25" fill="url(#parent-gradient)" class="pulse-circle" data-level="parent" />
                    <circle cx="350" cy="400" r="25" fill="url(#parent-gradient)" class="pulse-circle" data-level="parent" />
                    <circle cx="500" cy="400" r="25" fill="url(#parent-gradient)" class="pulse-circle" data-level="parent" />
                    <circle cx="650" cy="400" r="25" fill="url(#parent-gradient)" class="pulse-circle" data-level="parent" />
                    <circle cx="800" cy="400" r="25" fill="url(#parent-gradient)" class="pulse-circle" data-level="parent" />
                    
                    <!-- Children -->
                    <circle cx="150" cy="500" r="20" fill="url(#child-gradient)" class="pulse-circle" data-level="child" />
                    <circle cx="250" cy="500" r="20" fill="url(#child-gradient)" class="pulse-circle" data-level="child" />
                    <circle cx="300" cy="500" r="20" fill="url(#child-gradient)" class="pulse-circle" data-level="child" />
                    <circle cx="400" cy="500" r="20" fill="url(#child-gradient)" class="pulse-circle" data-level="child" />
                    <circle cx="450" cy="500" r="20" fill="url(#child-gradient)" class="pulse-circle" data-level="child" />
                    <circle cx="550" cy="500" r="20" fill="url(#child-gradient)" class="pulse-circle" data-level="child" />
                    <circle cx="600" cy="500" r="20" fill="url(#child-gradient)" class="pulse-circle" data-level="child" />
                    <circle cx="700" cy="500" r="20" fill="url(#child-gradient)" class="pulse-circle" data-level="child" />
                    <circle cx="750" cy="500" r="20" fill="url(#child-gradient)" class="pulse-circle" data-level="child" />
                    <circle cx="850" cy="500" r="20" fill="url(#child-gradient)" class="pulse-circle" data-level="child" />
                </g>
            </svg>
        </div>
        
        <div class="legend-container">
            <h4 style="margin-bottom: 1rem; font-size: 1rem;">Network Legend</h4>
            <div class="legend-item">
                <div class="legend-color" style="background: linear-gradient(135deg, #ff7a43, #ffcb43);"></div>
                <span>Founders</span>
            </div>
            <div class="legend-item">
                <div class="legend-color" style="background: linear-gradient(135deg, #7a43ff, #9b43ff);"></div>
                <span>Grandparents</span>
            </div>
            <div class="legend-item">
                <div class="legend-color" style="background: linear-gradient(135deg, #7a43ff, #43a1ff);"></div>
                <span>Parents</span>
            </div>
            <div class="legend-item">
                <div class="legend-color" style="background: linear-gradient(135deg, #43d1ff, #43ffd1);"></div>
                <span>Children</span>
            </div>
        </div>
    </div>
    
    <div class="row">
        <div class="col-lg-8 mx-auto">
            <div class="card mb-4">
                <div class="card-body">
                    <h3>About Your Trust Network</h3>
                    <p>This visualization represents your position in the Proof of Humanity trust network. Each node represents a verified human with connections to other members.</p>
                    <ul>
                        <li><strong>You</strong> are positioned at the top of your network as the center of your trust relationships.</li>
                        <li><strong>Grandparents</strong> are the initial verifiers who helped establish your network.</li>
                        <li><strong>Parents</strong> are directly verified by you or have verified others with you.</li>
                        <li><strong>Children</strong> are newer members who have been verified with your participation.</li>
                    </ul>
                    <p>As more humans join through your trust connections, your network grows and strengthens the entire proof of humanity ecosystem.</p>
                </div>
            </div>
        </div>
    </div>
</section>

<script>
    document.addEventListener('DOMContentLoaded', function() {
        // Add animation to nodes
        const circles = document.querySelectorAll('.pulse-circle');
        circles.forEach((circle, index) => {
            const originalR = parseFloat(circle.getAttribute('r'));
            const level = circle.getAttribute('data-level');
            let phaseOffset = index * 0.5; // Different starting phase for each circle
            
            // Different animation speeds based on network level
            let speed = 1;
            if (level === 'founder') speed = 0.7;
            else if (level === 'grandparent') speed = 0.8;
            else if (level === 'parent') speed = 0.9;
            else if (level === 'child') speed = 1.1;
            
            setInterval(() => {
                // Create a subtle pulsing effect
                const time = Date.now() / 1000;
                const factor = 1 + 0.1 * Math.sin(time * speed + phaseOffset);
                circle.setAttribute('r', originalR * factor);
            }, 50);
        });
        
        // Simple zoom controls
        const svg = document.querySelector('svg');
        let currentZoom = 1;
        const zoomStep = 0.2;
        
        document.querySelector('.zoom-in').addEventListener('click', function() {
            currentZoom += zoomStep;
            updateZoom();
        });
        
        document.querySelector('.zoom-out').addEventListener('click', function() {
            currentZoom = Math.max(0.5, currentZoom - zoomStep);
            updateZoom();
        });
        
        document.querySelector('.reset').addEventListener('click', function() {
            currentZoom = 1;
            updateZoom();
        });
        
        function updateZoom() {
            // Apply zoom by scaling the SVG
            svg.style.transform = `scale(${currentZoom})`;
            svg.style.transformOrigin = 'center center';
        }
    });
</script>
{% endblock %} 