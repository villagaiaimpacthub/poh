{% extends 'base.html' %}

{% block title %}Trust Network - Proof of Humanity{% endblock %}

{% block styles %}
<link rel="stylesheet" href="{{ url_for('static', filename='css/family-tree.css') }}">
<style>
    .network-container {
        max-width: 1200px;
        margin: 0 auto;
        padding: 1rem;
    }
    
    .visualization-container {
        background-color: rgba(30, 30, 40, 0.7);
        border-radius: 16px;
        box-shadow: 0 8px 30px rgba(0, 0, 0, 0.2);
        margin-bottom: 2rem;
        position: relative;
        overflow: hidden;
        min-height: 600px;
        border: 1px solid rgba(122, 67, 255, 0.3);
    }
    
    .visualization-header {
        padding: 1.5rem;
        border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        display: flex;
        justify-content: space-between;
        align-items: center;
    }
    
    .visualization-title {
        font-size: 1.5rem;
        font-weight: 600;
        color: white;
        margin: 0;
    }
    
    .controls-container {
        position: absolute;
        top: 1rem;
        right: 1rem;
        z-index: 10;
        display: flex;
        gap: 0.5rem;
    }
    
    .control-btn {
        padding: 0.5rem 1rem;
        border-radius: 8px;
        background: rgba(122, 67, 255, 0.2);
        border: 1px solid rgba(122, 67, 255, 0.3);
        color: white;
        font-weight: 500;
        display: flex;
        align-items: center;
        justify-content: center;
        cursor: pointer;
        transition: all 0.3s ease;
    }
    
    .control-btn:hover {
        background: rgba(122, 67, 255, 0.4);
        transform: translateY(-2px);
    }
    
    .control-btn i {
        margin-right: 0.5rem;
    }
    
    .legend-container {
        background-color: rgba(15, 15, 35, 0.8);
        border-radius: 12px;
        padding: 1rem;
        position: absolute;
        bottom: 1rem;
        left: 1rem;
        font-size: 0.9rem;
        z-index: 10;
        box-shadow: 0 4px 20px rgba(0, 0, 0, 0.2);
        border: 1px solid rgba(122, 67, 255, 0.3);
        color: white;
    }
    
    .legend-item {
        display: flex;
        align-items: center;
        margin-bottom: 0.75rem;
    }
    
    .legend-color {
        width: 16px;
        height: 16px;
        border-radius: 50%;
        margin-right: 0.75rem;
    }
    
    .legend-label {
        color: rgba(255, 255, 255, 0.9);
    }
    
    .network-stats {
        display: flex;
        flex-wrap: wrap;
        gap: 1.5rem;
        margin-bottom: 2rem;
    }
    
    .stats-card {
        flex: 1 1 200px;
        background-color: rgba(30, 30, 40, 0.7);
        border-radius: 12px;
        box-shadow: 0 8px 20px rgba(0, 0, 0, 0.1);
        padding: 1.5rem;
        text-align: center;
        border: 1px solid rgba(122, 67, 255, 0.3);
        transition: transform 0.3s ease;
    }
    
    .stats-card:hover {
        transform: translateY(-5px);
        box-shadow: 0 12px 30px rgba(0, 0, 0, 0.2);
    }
    
    .stats-number {
        font-size: 2.5rem;
        font-weight: 700;
        margin-bottom: 0.5rem;
        background: linear-gradient(135deg, var(--web5-primary) 0%, var(--web5-accent) 100%);
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
    }
    
    .stats-label {
        color: rgba(255, 255, 255, 0.7);
        font-size: 1rem;
    }
    
    .iframe-container {
        width: 100%;
        height: 600px;
    }
    
    .iframe-container iframe {
        width: 100%;
        height: 100%;
        border: none;
    }
</style>
{% endblock %}

{% block content %}
<div class="page-header">
    <div class="container">
        <h1>Trust Network</h1>
        <p>Explore the interconnected network of verified humans in the Proof of Humanity ecosystem.</p>
    </div>
</div>

<div class="network-container">
    <div class="network-stats">
        <div class="stats-card">
            <div class="stats-number" id="network-size">10,285</div>
            <div class="stats-label">Verified Humans</div>
        </div>
        
        <div class="stats-card">
            <div class="stats-number" id="connections-count">28,741</div>
            <div class="stats-label">Trust Connections</div>
        </div>
        
        <div class="stats-card">
            <div class="stats-number" id="growth-rate">+7.2%</div>
            <div class="stats-label">Monthly Growth</div>
        </div>
        
        <div class="stats-card">
            <div class="stats-number" id="active-verifiers">1,529</div>
            <div class="stats-label">Active Verifiers</div>
        </div>
    </div>
    
    <div class="visualization-container">
        <div class="visualization-header">
            <h2 class="visualization-title">Trust Network Visualization</h2>
            
            <div class="controls-container">
                <button class="control-btn" id="reset-view"><i class="fas fa-sync-alt"></i>Reset</button>
                <button class="control-btn" id="zoom-in"><i class="fas fa-search-plus"></i>Zoom In</button>
                <button class="control-btn" id="zoom-out"><i class="fas fa-search-minus"></i>Zoom Out</button>
            </div>
        </div>
        
        <div class="network-container" id="network-container">
            <!-- Network visualization will render here -->
            <iframe src="{{ url_for('network.viz') }}" width="100%" height="600px" frameborder="0" id="network-iframe"></iframe>
            <div class="zoom-controls">
                <button id="zoom-in" class="zoom-btn" title="Zoom In"><i class="fas fa-plus"></i></button>
                <button id="zoom-out" class="zoom-btn" title="Zoom Out"><i class="fas fa-minus"></i></button>
                <button id="zoom-reset" class="zoom-btn" title="Reset Zoom"><i class="fas fa-expand"></i></button>
            </div>
        </div>
        
        <div class="legend-container">
            <h4 style="margin-bottom: 1rem; color: white; font-size: 1rem;">Network Legend</h4>
            <div class="legend-item">
                <div class="legend-color" style="background-color: #ffb86c;"></div>
                <div class="legend-label">Founders</div>
            </div>
            <div class="legend-item">
                <div class="legend-color" style="background-color: #cd5ff8;"></div>
                <div class="legend-label">Grandparents</div>
            </div>
            <div class="legend-item">
                <div class="legend-color" style="background-color: #7a43ff;"></div>
                <div class="legend-label">Parents</div>
            </div>
            <div class="legend-item">
                <div class="legend-color" style="background-color: #43d1ff;"></div>
                <div class="legend-label">Children</div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
    document.addEventListener('DOMContentLoaded', function() {
        // Simple animation for stats numbers
        const statsNumbers = document.querySelectorAll('.stats-number');
        
        statsNumbers.forEach(number => {
            const finalValue = number.textContent;
            const duration = 2000; // 2 seconds
            const startValue = 0;
            
            let startTime = null;
            
            function animate(currentTime) {
                if (!startTime) startTime = currentTime;
                const elapsedTime = currentTime - startTime;
                const progress = Math.min(elapsedTime / duration, 1);
                
                // Parse the final value and format appropriately
                if (finalValue.includes('%')) {
                    const numericValue = parseFloat(finalValue);
                    const currentValue = (startValue + (numericValue * progress)).toFixed(1);
                    number.textContent = `+${currentValue}%`;
                } else {
                    const numericValue = parseInt(finalValue.replace(/,/g, ''), 10);
                    const currentValue = Math.floor(startValue + (numericValue * progress));
                    number.textContent = currentValue.toLocaleString();
                }
                
                if (progress < 1) {
                    requestAnimationFrame(animate);
                }
            }
            
            requestAnimationFrame(animate);
        });
        
        // Handle zoom controls to communicate with iframe
        const iframe = document.querySelector('iframe');
        const zoomInBtn = document.getElementById('zoom-in');
        const zoomOutBtn = document.getElementById('zoom-out');
        const resetBtn = document.getElementById('reset-view');
        
        zoomInBtn.addEventListener('click', function() {
            iframe.contentWindow.postMessage({ action: 'zoom-in' }, '*');
        });
        
        zoomOutBtn.addEventListener('click', function() {
            iframe.contentWindow.postMessage({ action: 'zoom-out' }, '*');
        });
        
        resetBtn.addEventListener('click', function() {
            iframe.contentWindow.postMessage({ action: 'reset' }, '*');
        });
    });
</script>
{% endblock %} 